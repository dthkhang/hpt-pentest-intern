# Tìm hiểu về Insecure direct object references (IDOR)
> TÊN TÀI LIỆU: IDOR Document <br>
THỰC HIỆN: Dương Tôn Hoàng Khang <br>
CẬP NHẬT CUỐI CÙNG: 03/10/2024<br>
>
## Mục lục
#### [1. What is Insecure direct object references (IDOR)?](#p1)<br>
#### [2. Lab thực hành](#p2)<br>
#### [3. Cách phòng tránh](#p3)<br>



<a id="p1"></a> <br>
## 1. What is Insecure direct object references (IDOR) <br>
Là một lỗ hổng bảo mật liên quan đến việc kiểm soát truy cập đến các tài nguyên (file, dữ liệu,...) mà không có đủ xác thực hoặc phân quyền. Điều này có thể khiến người dùng truy cập hoặc chỉnh sửa tài nguyên không thuộc về họ. <br>
Giải thích dễ hiểu: Khi bạn truy cập một tài nguyên trên website, ví dụ như tài liệu cá nhân hoặc đơn hàng, bạn thường sẽ thấy một liên kết với một ID cụ thể. Ví dụ: <br>
> https://exam.com/order/123 <br>

ID "123" ở đây có thể đại diện cho đơn hàng của bạn. Nếu website không kiểm tra kỹ quyền truy cập, bạn có thể thay đổi ID thành "124" để xem hoặc chỉnh sửa thông tin của đơn hàng của người khác: <br>
> https://website.com/order/124 <br>

Nếu trang web không chặn điều này, tức là nó có lỗ hổng IDOR. Người dùng có thể khai thác lỗ hổng này để truy cập vào dữ liệu của người khác mà không có sự cho phép. <br>
<a id="p2"></a>
## 2. Lab thực hành <br>
Ta có 1 lab sau của PortSwigger về IDOR <br>
    <img src="img/idor-exam.png" alt="alt text" width="600"> <br>
Phần description cụ thể là lab này có chức năng trò chuyện nhắn tin và có thể truy xuất lịch sử tin nhắn ra file bằng URLS nào đấy <br>
Cách pass lab này là tìm password của user carlos, đăng nhập thành công là done <br>
Recon time <br>
Bật Burp Suite lên, add URL Lab vào Scope để follow các request được gửi đi nhé <br>
Đây là giao diện chính của lab <br>
    <img src="img/idor1-exam.png" alt="alt text" width="600"> <br>
Test luôn chức năng Live chat vì trong description có hint <br>
    <img src="img/idor2-exam.png" alt="alt text" width="600"> <br>
Click View transcript để truy xuất lịch sử trò chuyện <br>
    <img src="img/idor3-exam.png" alt="alt text" width="600"> <br>
Ngó qua Burp Suite thì thấy khi click vào View transcript, sẽ gửi 1 request method GET đến /download-transcript/5.txt <br>
    <img src="img/idor4-exam.png" alt="alt text" width="600"> <br>
Chuyển nó qua repeater ngay và luôn, giả sử mình thay 5.txt bằng 6.txt thì sao nhỉ?<br>
    <img src="img/idor5-exam.png" alt="alt text" width="600"> <br>
Chả có gì, vậy thì từ 1 xem <br>
    <img src="img/idor6-exam.png" alt="alt text" width="600"> <br>
Ra password luôn này, logout ra, login với username carlos <br>
    <img src="img/idor7-exam.png" alt="alt text" width="600"> <br>
Trong lỗ hổng IDOR, một đối tượng (chẳng hạn như tài khoản người dùng hoặc tài nguyên nào đó) có thể bị truy cập bởi người dùng không được phép chỉ bằng cách thay đổi tham số ID trực tiếp trong URL hoặc yêu cầu. Điều này xảy ra khi ứng dụng không kiểm tra quyền truy cập của người dùng một cách chính xác, dẫn đến việc người dùng có thể xem hoặc thao tác với dữ liệu của người khác.<a id="p3"></a>
## 3. Cách phòng tránh <br>
- Luôn kiểm tra quyền truy cập của người dùng với từng tài nguyên. 
<br> Ví dụ: chỉ user sở hữu đơn hàng mới được phép xem và chỉnh sửa đơn hàng của họ. <br>
-  Sử dụng ID phức tạp (Non-sequential IDs) <br>
    - VD: Thay vì sử dụng đường dẫn: <br>
    > https://exam.com/order/101<br>

    Hãy sử dụng một token tạm thời hoặc mã hóa: <br>
    > https://exam.com/order/ab1234cdef5678 <br>


